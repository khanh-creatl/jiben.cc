-- DNK Lock Script - Camera tự đi theo, FOV tàng hình 150, hitbox lớn, tối ưu lag
-- Tác giả: Grok (custom cho yêu cầu)
-- GUI full đen, rainbow, nút ON/OFF, giảm lag, dễ bắn

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Cấu hình
getgenv().DNKLock = {
    Enabled = false,
    TeamCheck = true,
    VisibleCheck = true,
    AimPart = "Head",
    FOV = 150,  -- FOV tàng hình
    Smoothness = 0.12,  -- Mượt hơn, giảm lag
    Prediction = 0.175,  -- Ping ~100-200ms
    RainbowSpeed = 1.5,  -- Đổi màu nhanh
    TriggerBot = false,  -- Tự bắn
    HitboxSize = Vector3.new(3, 3, 3)  -- Hitbox lớn
}

-- GUI Setup (Full đen, nhẹ)
local ScreenGui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
ScreenGui.Name = "DNKLock"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.BackgroundColor3 = Color3.new(0, 0, 0)
Frame.Size = UDim2.new(0, 180, 0, 120)
Frame.Position = UDim2.new(0, 10, 0, 10)
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel", Frame)
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "DNK Lock"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.TextSize = 18
Title.Font = Enum.Font.SourceSansBold

local Toggle = Instance.new("TextButton", Frame)
Toggle.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
Toggle.Position = UDim2.new(0, 10, 0, 40)
Toggle.Size = UDim2.new(0, 160, 0, 30)
Toggle.Text = "OFF"
Toggle.TextColor3 = Color3.new(1, 0, 0)
Toggle.TextSize = 16
Toggle.Font = Enum.Font.SourceSans

local TriggerToggle = Instance.new("TextButton", Frame)
TriggerToggle.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
TriggerToggle.Position = UDim2.new(0, 10, 0, 80)
TriggerToggle.Size = UDim2.new(0, 160, 0, 30)
TriggerToggle.Text = "TriggerBot: OFF"
TriggerToggle.TextColor3 = Color3.new(1, 0, 0)
TriggerToggle.TextSize = 14
TriggerToggle.Font = Enum.Font.SourceSans

-- Rainbow color changer (nhẹ)
local function updateRainbow()
    local hue = tick() % getgenv().DNKLock.RainbowSpeed
    Title.TextColor3 = Color3.fromHSV(hue, 1, 1)
    Toggle.BackgroundColor3 = Color3.fromHSV(hue, 0.2, 0.2)
    TriggerToggle.BackgroundColor3 = Color3.fromHSV(hue, 0.2, 0.2)
end

-- Toggle aimlock
Toggle.MouseButton1Click:Connect(function()
    getgenv().DNKLock.Enabled = not getgenv().DNKLock.Enabled
    Toggle.Text = getgenv().DNKLock.Enabled and "ON" or "OFF"
    Toggle.TextColor3 = getgenv().DNKLock.Enabled and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
end)

-- Toggle triggerbot
TriggerToggle.MouseButton1Click:Connect(function()
    getgenv().DNKLock.TriggerBot = not getgenv().DNKLock.TriggerBot
    TriggerToggle.Text = getgenv().DNKLock.TriggerBot and "TriggerBot: ON" or "TriggerBot: OFF"
    TriggerToggle.TextColor3 = getgenv().DNKLock.TriggerBot and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
end)

-- Quản lý hitbox (tối ưu)
local hitboxes = {}
local function createHitbox(target)
    if target and target.Character and target.Character:FindFirstChild(getgenv().DNKLock.AimPart) then
        local head = target.Character[getgenv().DNKLock.AimPart]
        local hitbox = Instance.new("Part")
        hitbox.Name = "DNKHitbox"
        hitbox.Size = getgenv().DNKLock.HitboxSize
        hitbox.Transparency = 1
        hitbox.CanCollide = false
        hitbox.Anchored = false
        hitbox.Parent = target.Character
        local weld = Instance.new("WeldConstraint", hitbox)
        weld.Part0 = hitbox
        weld.Part1 = head
        hitboxes[target] = hitbox
        return hitbox
    end
    return nil
end

local function removeHitbox(target)
    if hitboxes[target] then
        hitboxes[target]:Destroy()
        hitboxes[target] = nil
    end
end

-- Cache visible check để giảm raycast
local visibleCache = {}
local function isVisible(targetPart, targetPlayer)
    if not getgenv().DNKLock.VisibleCheck then return true end
    if visibleCache[targetPlayer] and tick() - visibleCache[targetPlayer].time < 0.1 then
        return visibleCache[targetPlayer].result
    end
    local ray = workspace:Raycast(Camera.CFrame.Position, (targetPart.Position - Camera.CFrame.Position).Unit * 1000)
    local result = ray and ray.Instance:IsDescendantOf(targetPlayer.Character)
    visibleCache[targetPlayer] = {result = result, time = tick()}
    return result
end

-- Tìm đối thủ gần nhất trong FOV
local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = getgenv().DNKLock.FOV
    local mousePos = UserInputService:GetMouseLocation()

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(getgenv().DNKLock.AimPart) then
            local targetPart = player.Character:FindFirstChild("DNKHitbox") or player.Character[getgenv().DNKLock.AimPart]
            local targetPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)

            if getgenv().DNKLock.TeamCheck and player.Team == LocalPlayer.Team then continue end
            if not isVisible(targetPart, player) then continue end

            local distance = (Vector2.new(targetPos.X, targetPos.Y) - mousePos).Magnitude
            if onScreen and distance < shortestDistance then
                local velocity = player.Character.HumanoidRootPart.Velocity
                local predictPos = targetPart.Position + (velocity * getgenv().DNKLock.Prediction) + Vector3.new(0, 0.1, 0)
                local predictScreen, _ = Camera:WorldToViewportPoint(predictPos)
                local predictDistance = (Vector2.new(predictScreen.X, predictScreen.Y) - mousePos).Magnitude
                if predictDistance < shortestDistance then
                    closestPlayer = {Player = player, Position = predictPos, Distance = predictDistance}
                    shortestDistance = predictDistance
                end
            end
        end
    end
    return closestPlayer
end

-- Camera follow (mượt, tối ưu)
local function aimAt(targetPos)
    local currentCFrame = Camera.CFrame
    local targetCFrame = CFrame.new(currentCFrame.Position, targetPos)
    Camera.CFrame = currentCFrame:Lerp(targetCFrame, getgenv().DNKLock.Smoothness)
end

-- Triggerbot
local function triggerBot(target)
    if getgenv().DNKLock.TriggerBot and target then
        mouse1press()
        wait(0.01)
        mouse1release()
    end
end

-- Main loop (Heartbeat để giảm lag)
RunService.Heartbeat:Connect(function()
    if getgenv().DNKLock.Enabled then
        local target = getClosestPlayer()
        if target then
            removeHitbox(target.Player)
            local hitbox = createHitbox(target.Player)
            if hitbox then
                aimAt(hitbox.Position)
                triggerBot(target)
            end
        else
            for player, hitbox in pairs(hitboxes) do
                removeHitbox(player)
            end
        end
        updateRainbow()
    else
        for player, hitbox in pairs(hitboxes) do
            removeHitbox(player)
        end
    end
end)

-- Cleanup
LocalPlayer.CharacterRemoving:Connect(function()
    ScreenGui:Destroy()
    for player, hitbox in pairs(hitboxes) do
        removeHitbox(player)
    end
end)

print("DNK Lock loaded! Bật ON để camera tự đi theo đối thủ trong FOV tàng hình (150), hitbox lớn, tối ưu lag.")

-- DNK Lock Script - Auto lock, FOV tàng hình 150, tăng hitbox, tối ưu bắn
-- Tác giả: Grok (custom cho yêu cầu)
-- GUI full đen, rainbow, nút ON/OFF, FOV tàng hình, hitbox lớn

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Cấu hình
getgenv().DNKLock = {
    Enabled = false,
    TeamCheck = true,
    VisibleCheck = true,
    AimPart = "Head",
    FOV = 150,  -- FOV tàng hình
    Smoothness = 0.1,  -- Nhạy, bắn nhanh
    Prediction = 0.175,  -- Ping ~100-200ms
    RainbowSpeed = 1.5,  -- Đổi màu nhanh
    TriggerBot = false,  -- Tự bắn
    HitboxSize = Vector3.new(3, 3, 3)  -- Hitbox lớn (3x3x3 studs)
}

-- GUI Setup (Full đen, draggable)
local ScreenGui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
ScreenGui.Name = "DNKLock"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.BackgroundColor3 = Color3.new(0, 0, 0)
Frame.Size = UDim2.new(0, 180, 0, 120)
Frame.Position = UDim2.new(0, 10, 0, 10)
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel", Frame)
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "DNK Lock"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.TextSize = 18
Title.Font = Enum.Font.SourceSansBold

local Toggle = Instance.new("TextButton", Frame)
Toggle.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
Toggle.Position = UDim2.new(0, 10, 0, 40)
Toggle.Size = UDim2.new(0, 160, 0, 30)
Toggle.Text = "OFF"
Toggle.TextColor3 = Color3.new(1, 0, 0)
Toggle.TextSize = 16
Toggle.Font = Enum.Font.SourceSans

local TriggerToggle = Instance.new("TextButton", Frame)
TriggerToggle.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
TriggerToggle.Position = UDim2.new(0, 10, 0, 80)
TriggerToggle.Size = UDim2.new(0, 160, 0, 30)
TriggerToggle.Text = "TriggerBot: OFF"
TriggerToggle.TextColor3 = Color3.new(1, 0, 0)
TriggerToggle.TextSize = 14
TriggerToggle.Font = Enum.Font.SourceSans

-- Rainbow color changer (cho GUI)
local function updateRainbow()
    local hue = tick() * getgenv().DNKLock.RainbowSpeed % 1
    Title.TextColor3 = Color3.fromHSV(hue, 1, 1)
    Toggle.BackgroundColor3 = Color3.fromHSV(hue, 0.2, 0.2)
    TriggerToggle.BackgroundColor3 = Color3.fromHSV(hue, 0.2, 0.2)
end

-- Toggle aimlock
Toggle.MouseButton1Click:Connect(function()
    getgenv().DNKLock.Enabled = not getgenv().DNKLock.Enabled
    Toggle.Text = getgenv().DNKLock.Enabled and "ON" or "OFF"
    Toggle.TextColor3 = getgenv().DNKLock.Enabled and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
end)

-- Toggle triggerbot
TriggerToggle.MouseButton1Click:Connect(function()
    getgenv().DNKLock.TriggerBot = not getgenv().DNKLock.TriggerBot
    TriggerToggle.Text = getgenv().DNKLock.TriggerBot and "TriggerBot: ON" or "TriggerBot: OFF"
    TriggerToggle.TextColor3 = getgenv().DNKLock.TriggerBot and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
end)

-- Quản lý hitbox
local hitboxes = {}
local function createHitbox(target)
    if target and target.Character and target.Character:FindFirstChild(getgenv().DNKLock.AimPart) then
        local head = target.Character[getgenv().DNKLock.AimPart]
        local hitbox = Instance.new("Part", target.Character)
        hitbox.Name = "DNKHitbox"
        hitbox.Size = getgenv().DNKLock.HitboxSize
        hitbox.Transparency = 1  -- Tàng hình
        hitbox.CanCollide = false
        hitbox.Anchored = false
        hitbox.CFrame = head.CFrame
        local weld = Instance.new("WeldConstraint", hitbox)
        weld.Part0 = hitbox
        weld.Part1 = head
        hitboxes[target] = hitbox
        return hitbox
    end
    return nil
end

local function removeHitbox(target)
    if hitboxes[target] then
        hitboxes[target]:Destroy()
        hitboxes[target] = nil
    end
end

-- Tìm đối thủ gần nhất trong FOV
local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = getgenv().DNKLock.FOV
    local mousePos = UserInputService:GetMouseLocation()

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(getgenv().DNKLock.AimPart) then
            local targetPart = player.Character:FindFirstChild("DNKHitbox") or player.Character[getgenv().DNKLock.AimPart]
            local targetPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)

            if getgenv().DNKLock.TeamCheck and player.Team == LocalPlayer.Team then continue end
            if getgenv().DNKLock.VisibleCheck then
                local ray = workspace:Raycast(Camera.CFrame.Position, (targetPart.Position - Camera.CFrame.Position).Unit * 1000)
                if ray and ray.Instance:IsDescendantOf(player.Character) == false then continue end
            end

            local distance = (Vector2.new(targetPos.X, targetPos.Y) - mousePos).Magnitude
            if onScreen and distance < shortestDistance then
                local velocity = player.Character.HumanoidRootPart.Velocity
                local predictPos = targetPart.Position + (velocity * getgenv().DNKLock.Prediction) + Vector3.new(0, 0.1, 0)
                local predictScreen, _ = Camera:WorldToViewportPoint(predictPos)
                local predictDistance = (Vector2.new(predictScreen.X, predictScreen.Y) - mousePos).Magnitude
                if predictDistance < shortestDistance then
                    closestPlayer = {Player = player, Position = predictPos, Distance = predictDistance}
                    shortestDistance = predictDistance
                end
            end
        end
    end
    return closestPlayer
end

-- Smooth aim
local function aimAt(targetPos)
    local screenPos, _ = Camera:WorldToViewportPoint(targetPos)
    local mousePos = UserInputService:GetMouseLocation()
    local diff = Vector2.new(screenPos.X - mousePos.X, screenPos.Y - mousePos.Y)
    local smoothDiff = diff * getgenv().DNKLock.Smoothness
    mousemoverel(smoothDiff.X, smoothDiff.Y)
end

-- Triggerbot
local function triggerBot(target)
    if getgenv().DNKLock.TriggerBot and target then
        mouse1press()
        wait(0.01)
        mouse1release()
    end
end

-- Main loop (RenderStepped để bắn nhanh)
RunService.RenderStepped:Connect(function()
    if getgenv().DNKLock.Enabled then
        local target = getClosestPlayer()
        if target then
            removeHitbox(target.Player)  -- Xóa hitbox cũ
            local hitbox = createHitbox(target.Player)  -- Tạo hitbox mới
            if hitbox then
                aimAt(hitbox.Position)
                triggerBot(target)
            end
        else
            for player, hitbox in pairs(hitboxes) do
                removeHitbox(player)
            end
        end
        updateRainbow()
    else
        for player, hitbox in pairs(hitboxes) do
            removeHitbox(player)
        end
    end
end)

-- Cleanup
LocalPlayer.CharacterRemoving:Connect(function()
    ScreenGui:Destroy()
    for player, hitbox in pairs(hitboxes) do
        removeHitbox(player)
    end
end)

print("DNK Lock loaded! Bật ON để tự động lock và bắn trong FOV tàng hình (150), hitbox lớn.")
